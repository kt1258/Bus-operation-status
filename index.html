<!DOCTYPE html>
<html lang="ja" id="html-tag">
<head>
  <meta charset="UTF-8">
  <title>„Éê„ÇπÈÅãË°åÁä∂Ê≥Å</title>
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans JP", sans-serif;
      overflow: hidden;
    }
    body:lang(ko) { font-family: "Noto Sans KR", sans-serif; }
    body:lang(zh-CN) { font-family: "Noto Sans SC", sans-serif; }
    body:lang(zh-TW) { font-family: "Noto Sans TC", sans-serif; }
    #welcome-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #222;
      color: white;
      padding-bottom: 15vh; /* „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çí‰∏ä„Å´ÁßªÂãï */
      box-sizing: border-box;
    }
    #welcome-screen h1 {
      font-size: 2.5em;
      display: flex;
      align-items: center;
      /* border-bottom: 2px solid white; */ /* „Åì„ÅÆË°å„ÇíÂâäÈô§„Åæ„Åü„ÅØ„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà */
      padding-bottom: 20px;
      margin-bottom: 40px;
    }
    .welcome-lang-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    .welcome-lang-buttons button {
      font-size: 1.5em;
      padding: 20px;
      background-color: #444;
      color: white;
      border: 1px solid #666;
      cursor: pointer;
      border-radius: 8px;
    }
    .welcome-lang-buttons .full-width {
      grid-column: 1 / -1;
    }
    .main {
      display: flex;
      width: 100%;
      height: 100vh;
    }
    .bus-area {
      background-color: #222;
      color: white;
      padding: 2.5vw;
      flex: 1;
      display: flex;
      flex-direction: column;
      transition: transform 0.4s ease-in-out, filter 0.4s ease-in-out;
      transform-origin: center;
    }
    .bus-area.settings-active {
      transform: scale(0.85);
      border-radius: 20px;
      filter: brightness(0.7);
      box-shadow: -5px 0 25px rgba(0,0,0,0.5);
    }
    .settings-area {
      background-color: #ddd;
      color: black;
      padding: 20px;
      flex: 0 0 320px;
      display: none;
      flex-direction: column;
    }
    .settings-area > div {
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 1.5vh;
    }
    .left {
      display: flex;
      align-items: center;
      white-space: nowrap;
    }
    .bus-icon { font-size: 3.8vw; }
    .title { font-size: 4vw; margin-left: 2vw; }
    .gear { font-size: 3.5vw; cursor: pointer; }
    #current-time { font-size: 3.5vw; }
    .route {
      font-size: 5vw;
      margin: 2vh 0;
      border-top: 2px solid white;
      padding-top: 2vh;
      color: #FFA600;
    }
    .time-table {
      font-size: 4vw;
      line-height: 1.7;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
    }
    .time-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      white-space: nowrap;
      padding: 0 2.5vw;
      box-sizing: border-box;
    }
    .time-large {
      font-size: 6.5vw;
      font-weight: bold;
    }
    .bus-area.settings-active .route { font-size: 4vw; }
    .bus-area.settings-active .time-table { font-size: 3.5vw; }
    .bus-area.settings-active .time-large { font-size: 5.5vw; }
    .predicted-time { color: #FFD000; }
    .hidden { display: none !important; }
    .header-row {
      display: flex;
      align-items: center;
      font-size: 24px;
      cursor: pointer;
    }
    .header-row .back-arrow { font-size: 30px; font-weight: bold; }
    .header-row span { margin-left: 10px; }
    .section { margin-top: 30px; }
    .section.scrollable {
        flex: 1;
        overflow-y: auto;
        min-height: 0;
        padding-right: 10px;
        font-size: 16px;
        line-height: 1.6;
    }
    .section.scrollable a {
        color: #0000EE;
    }
    .setting-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    .setting-buttons button {
      font-size: 20px;
      padding: 15px 10px;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
      min-width: 0;
      border-radius: 5px;
    }
    .language-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 10px;
    }
    .language-buttons button {
      font-size: 18px;
      padding: 15px;
      background-color: #555;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
      border-radius: 5px;
    }
    .route-selection-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 10px;
    }
    .route-selection-buttons button {
        font-size: 18px;
        padding: 15px;
        background-color: #555;
        color: white;
        border: none;
        cursor: pointer;
        text-align: center;
        border-radius: 5px;
    }
    .language-buttons button.active,
    .route-selection-buttons button.active { background-color: #4CAF50; }
    .color-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 18px;
    }
    .color-row input[type="color"] {
      width: 50px;
      height: 30px;
      border: none;
      cursor: pointer;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

  <div id="welcome-screen">
      <h1><span class="bus-icon">üöç</span> ÈÅãË°åÊÉÖÂ†±Ë°®Á§∫</h1>
      <div class="welcome-lang-buttons">
          <button onclick="startApp('ja')">Êó•Êú¨Ë™û</button>
          <button onclick="startApp('en')">English</button>
          <button onclick="startApp('zh-CN')">‰∏≠Êñá(ÁÆÄ‰Ωì)</button>
          <button onclick="startApp('zh-TW')">‰∏≠Êñá(Á∞°È´î)</button>
          <button class="full-width" onclick="startApp('ko')">ÌïúÍµ≠Ïñ¥</button>
      </div>
  </div>

  <div class="main" id="main-container" style="display: none;">
    <div class="bus-area" id="bus-status">
      <div class="top-bar">
        <div class="left">
          <span class="bus-icon">üöç</span>
          <span class="title" id="title-text"></span>
        </div>
        <div>
          <span id="current-time" style="margin-right: 10px;">16:40</span>
          <span class="gear" onclick="openSettings()">‚öôÔ∏è</span>
        </div>
      </div>
      <div class="route" id="route-name"></div>
      <div class="time-table" id="time-table"></div>
    </div>

    <div class="settings-area" id="settings-panel">
      <div id="settings-main">
        <div class="header-row" onclick="closeSettings()"><span class="back-arrow">&lt;</span> <span id="settings-back-to-main-text"></span></div>
        <div class="section">
          <h3 id="settings-main-title"></h3>
          <div class="setting-buttons">
            <button id="settings-btn-display" onclick="showSettingsPanel('display-settings')"></button>
            <button id="settings-btn-stop" onclick="showSettingsPanel('bus-stop-settings')"></button>
            <button id="settings-btn-lang" onclick="showSettingsPanel('language-settings')"></button>
            <button id="settings-btn-terms" onclick="showSettingsPanel('terms-settings')"></button>
          </div>
        </div>
      </div>

      <div id="display-settings" class="hidden">
        <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span> <span id="display-settings-back-text"></span></div>
        <div class="section">
          <h3 id="display-settings-title"></h3>
          <div class="color-row"><span id="color-label-base"></span><input type="color" id="color-picker-base" onchange="changeColor('base', this.value)"></div>
          <div class="color-row"><span id="color-label-title"></span><input type="color" id="color-picker-title" onchange="changeColor('title', this.value)"></div>
          <div class="color-row"><span id="color-label-time"></span><input type="color" id="color-picker-time" onchange="changeColor('time', this.value)"></div>
          <div class="color-row"><span id="color-label-route"></span><input type="color" id="color-picker-route" onchange="changeColor('route', this.value)"></div>
          <div class="color-row"><span id="color-label-scheduled"></span><input type="color" id="color-picker-scheduled" onchange="changeColor('scheduled', this.value)"></div>
          <div class="color-row"><span id="color-label-predicted"></span><input type="color" id="color-picker-predicted" onchange="changeColor('predicted', this.value)"></div>
        </div>
      </div>

      <div id="language-settings" class="hidden">
        <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span> <span id="lang-settings-back-text"></span></div>
        <div class="section">
          <h3 id="lang-settings-title"></h3>
          <div class="language-buttons">
            <button class="active" onclick="selectLanguage(this)" data-lang="ja">Êó•Êú¨Ë™û</button>
            <button onclick="selectLanguage(this)" data-lang="en">English</button>
            <button onclick="selectLanguage(this)" data-lang="zh-CN">‰∏≠Êñá(ÁÆÄ‰Ωì)</button>
            <button onclick="selectLanguage(this)" data-lang="zh-TW">‰∏≠Êñá(Á∞°È´î)</button>
            <button onclick="selectLanguage(this)" data-lang="ko">ÌïúÍµ≠Ïñ¥</button>
          </div>
        </div>
      </div>
      
      <div id="bus-stop-settings" class="hidden">
        <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span> <span id="bus-stop-settings-back-text"></span></div>
        <div class="section">
          <h3 id="bus-stop-settings-title"></h3>
          <div class="route-selection-buttons">
            <button id="route-btn-mukaihara" class="active" onclick="selectRoute(this, 'mukaihara')"></button>
            <button id="route-btn-reitaku" onclick="selectRoute(this, 'reitaku')"></button>
          </div>
        </div>
      </div>

      <div id="terms-settings" class="hidden">
          <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span><span id="terms-settings-back-text"></span></div>
          <div class="section scrollable">
              <h3 id="terms-settings-title"></h3>
              <p id="terms-text-1"></p>
              <p id="terms-text-2"></p>
          </div>
      </div>

    </div>
  </div>

<script>
    let currentRouteId = 'mukaihara';
    const routeData = {
        mukaihara: { ja: "ÂêëÂéü ‚ûù ÂçóÊüèÈßÖÊù±Âè£", en: "Mukaihara ‚Üí Minami-Kashiwa Sta. EAST", 'zh-CN': "ÂêëÂéü ‚Üí ÂçóÊüèÁ´ô‰∏úÂè£", 'zh-TW': "ÂêëÂéü ‚Üí ÂçóÊüèÁ´ôÊù±Âè£", ko: "Î¨¥Ïπ¥Ïù¥ÌïòÎùº ‚Üí ÎØ∏ÎÇòÎØ∏Ïπ¥ÏãúÏôÄÏó≠ ÎèôÏ™Ω Ï∂úÍµ¨" },
        reitaku: { ja: "È∫óÊæ§Â§ßÂ≠¶Ââç ‚ûù ÂçóÊüèÈßÖÊù±Âè£", en: "Reitaku Daigaku-mae ‚Üí Minami-Kashiwa Sta. EAST", 'zh-CN': "‰∏ΩÊ≥ΩÂ§ßÂ≠¶Ââç ‚Üí ÂçóÊüèÁ´ô‰∏úÂè£", 'zh-TW': "È∫óÊæ§Â§ßÂ≠∏Ââç ‚Üí ÂçóÊüèÁ´ôÊù±Âè£", ko: "Î†àÏù¥ÌÉÄÏø†ÎåÄÌïô Ïïû ‚Üí ÎØ∏ÎÇòÎØ∏Ïπ¥ÏãúÏôÄÏó≠ ÎèôÏ™Ω Ï∂úÍµ¨" }
    };
    const translations = {
        ja: { title: "„Éê„ÇπÈÅãË°åÁä∂Ê≥Å", scheduled: "ÂÆöÂàª", predicted: "‰∫àÊ∏¨", departure: "Áô∫", settings_back_to_main: "„É°„Ç§„É≥ÁîªÈù¢", settings_main_title: "Ë®≠ÂÆö", btn_display: "Ë°®Á§∫", btn_stop: "„Éê„ÇπÂÅúÂ§âÊõ¥", btn_lang: "Ë®ÄË™û", btn_terms: "Âà©Áî®Ë¶èÁ¥Ñ", settings_back: "Ë®≠ÂÆö", display_title: "Ë°®Á§∫", lang_title: "Ë®ÄË™û", bus_stop_title: "„Éê„ÇπÂÅúÂ§âÊõ¥", terms_title: "Âà©Áî®Ë¶èÁ¥Ñ", color_base: "„Éô„Éº„Çπ", color_title: "„Çø„Ç§„Éà„É´", color_time: "ÁèæÂú®ÊôÇÂàª", color_route: "Ë∑ØÁ∑öÂêç", color_scheduled: "ÂÆöÂàªÊôÇÈñì", color_predicted: "‰∫àÊ∏¨ÊôÇÈñì",
            terms_text_1: "ÈÅãË°åÊÉÖÂ†±Ë°®Á§∫Êùø„ÅØÊù±Ê≠¶„Éê„ÇπÂèä„Å≥Ê†™Âºè‰ºöÁ§æ„Éä„Éì„Çø„Ç§„É†„Ç∏„É£„Éë„É≥„ÅåÊèê‰æõ„Åô„Çã„Äå„Éê„Çπ‰ΩçÁΩÆÊÉÖÂ†±„Äç„Åã„Çâ„Çπ„ÇØ„É¨„Ç§„Éî„É≥„Ç∞„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„Åü„Å†„Åó„ÄÅ„Åì„Çå„ÅØ„Éó„É≠„Éà„Çø„Ç§„Éó„Åß„ÅÇ„Çã„Åü„ÇÅ„ÄÅ„Çπ„ÇØ„É¨„Ç§„Éî„É≥„Ç∞„ÇíË°å„Å£„Å¶„Åä„Çä„Åæ„Åõ„Çì„ÄÇ",
            terms_text_2: "Ë©≥„Åó„Åè„ÅØÊù±Ê≠¶„Éê„Çπ„Äå<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">„ÅîÂà©Áî®„Å´„ÅÇ„Åü„Å£„Å¶ÔºàÂÖçË≤¨„Å´„Å§„ÅÑ„Å¶Á≠âÔºâ</a>„Äç„Çí„ÅîË¶ß„Åè„Å†„Åï„ÅÑ„ÄÇ"
        },
        en: { title: "Bus operation status", scheduled: "Schedule", predicted: "Predicted", departure: "", settings_back_to_main: "Main screen", settings_main_title: "Setting", btn_display: "Display", btn_stop: "Bus stop change", btn_lang: "Language", btn_terms: "Terms of service", settings_back: "Setting", display_title: "Display", lang_title: "Language", bus_stop_title: "Bus stop change", terms_title: "Terms of service", color_base: "Base", color_title: "Title", color_time: "Current time", color_route: "Route name", color_scheduled: "Scheduled time", color_predicted: "Predicted time",
            terms_text_1: "The Bus Operation Status board is scraped from the 'Bus Location' provided by Tobu Bus and NAVITIME JAPAN CORPORATION. However, as this is a prototype, it does not actually perform scraping.",
            terms_text_2: "For details, please see the Tobu Bus '<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">Terms of Use (Disclaimer, etc.)</a>'."
        },
        'zh-CN': { title: "ÂÖ¨‰∫§ËøêËê•Áä∂ÂÜµ", scheduled: "È¢ÑÂÆö", predicted: "È¢ÑÊµã", departure: "Âá∫Âèë", settings_back_to_main: "‰∏ªÂ±èÂπï", settings_main_title: "ËÆæÁΩÆ", btn_display: "ÊòæÁ§∫", btn_stop: "ÂÖ¨‰∫§ËΩ¶Á´ôÂèòÊõ¥", btn_lang: "ËØ≠Ë®Ä", btn_terms: "ÊúçÂä°Êù°Ê¨æ", settings_back: "ËÆæÁΩÆ", display_title: "ÊòæÁ§∫", lang_title: "ËØ≠Ë®Ä", bus_stop_title: "ÂÖ¨‰∫§ËΩ¶Á´ôÂèòÊõ¥", terms_title: "ÊúçÂä°Êù°Ê¨æ", color_base: "Âü∫Á°Ä", color_title: "Ê†áÈ¢ò", color_time: "ÂΩìÂâçÊó∂Èó¥", color_route: "Ë∑ØÁ∫øÂêçÁß∞", color_scheduled: "È¢ÑÂÆöÊó∂Èó¥", color_predicted: "È¢ÑËÆ°Êó∂Èó¥",
            terms_text_1: "Ê≠§ÂÖ¨‰∫§ËΩ¶ËøêË°å‰ø°ÊÅØÊòæÁ§∫ÊùøÁöÑÂÜÖÂÆπÊòØ‰ªé‰∏úÊ≠¶Â∑¥Â£´‰ª•ÂèäNAVITIME JAPANÂÖ¨Âè∏Êèê‰æõÁöÑ‚ÄúÂ∑¥Â£´‰ΩçÁΩÆ‚Äù‰∏≠ÊäìÂèñÁöÑ„ÄÇ‰ΩÜÁî±‰∫éËøôÂè™ÊòØ‰∏Ä‰∏™ÂéüÂûãÔºåÂõ†Ê≠§Âπ∂Êú™ÂÆûÈôÖËøõË°åÊäìÂèñ„ÄÇ",
            terms_text_2: "ËØ¶ÊÉÖËØ∑ÂèÇÈòÖ‰∏úÊ≠¶Â∑¥Â£´ÁöÑ‚Äú<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">‰ΩøÁî®Êù°Ê¨æÔºàÂÖçË¥£Â£∞ÊòéÁ≠âÔºâ</a>‚Äù„ÄÇ"
        },
        'zh-TW': { title: "ÂÖ¨ËªäÁáüÈÅãÁãÄÊ≥Å", scheduled: "È†êÂÆö", predicted: "È†êÊ∏¨", departure: "Âá∫Áôº", settings_back_to_main: "‰∏ªËû¢Âπï", settings_main_title: "Ë®≠ÂÆö", btn_display: "È°ØÁ§∫", btn_stop: "ÂÖ¨ËªäÁ´ôËÆäÊõ¥", btn_lang: "Ë™ûË®Ä", btn_terms: "ÊúçÂãôÊ¢ùÊ¨æ", settings_back: "Ë®≠ÂÆö", display_title: "È°ØÁ§∫", lang_title: "Ë™ûË®Ä", bus_stop_title: "ÂÖ¨ËªäÁ´ôËÆäÊõ¥", terms_title: "ÊúçÂãôÊ¢ùÊ¨æ", color_base: "Âü∫Á§é", color_title: "Ê®ôÈ°å", color_time: "Áï∂ÂâçÊôÇÈñì", color_route: "Ë∑ØÁ∑öÂêçÁ®±", color_scheduled: "È†êÂÆöÊôÇÈñì", color_predicted: "È†êÊ∏¨ÊôÇÈñì",
            terms_text_1: "Ê≠§ÂÖ¨ËªäÁáüÈÅãÁãÄÊ≥ÅÈ°ØÁ§∫ÊùøÁöÑÂÖßÂÆπÊòØÂæûÊù±Ê≠¶Â∑¥Â£´‰ª•ÂèäNAVITIME JAPANÂÖ¨Âè∏Êèê‰æõÁöÑ‚ÄúÂ∑¥Â£´‰ΩçÁΩÆ‚Äù‰∏≠Êì∑ÂèñÁöÑ„ÄÇ‰ΩÜÁî±ÊñºÈÄôÂè™ÊòØ‰∏ÄÂÄãÂéüÂûãÔºåÂõ†Ê≠§‰∏¶Êú™ÂØ¶ÈöõÈÄ≤Ë°åÊì∑Âèñ„ÄÇ",
            terms_text_2: "Ë©≥ÊÉÖË´ãÂèÉÈñ±Êù±Ê≠¶Â∑¥Â£´ÁöÑ„Äå<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">‰ΩøÁî®Ê¢ùÊ¨æÔºàÂÖçË≤¨ËÅ≤ÊòéÁ≠âÔºâ</a>„Äç„ÄÇ"
        },
        ko: { title: "Î≤ÑÏä§ Ïö¥Ìñâ ÌòÑÌô©", scheduled: "Ï†ïÏãú", predicted: "ÏòàÏ∏°", departure: "Ï∂úÎ∞ú", settings_back_to_main: "Î©îÏù∏ ÌôîÎ©¥", settings_main_title: "ÏÑ§Ï†ï", btn_display: "ÌëúÏãú", btn_stop: "Î≤ÑÏä§ Ï†ïÎ•òÏû• Î≥ÄÍ≤Ω", btn_lang: "Ïñ∏Ïñ¥", btn_terms: "Ïù¥Ïö©ÏïΩÍ¥Ä", settings_back: "ÏÑ§Ï†ï", display_title: "ÌëúÏãú", lang_title: "Ïñ∏Ïñ¥", bus_stop_title: "Î≤ÑÏä§ Ï†ïÎ•òÏû• Î≥ÄÍ≤Ω", terms_title: "Ïù¥Ïö©ÏïΩÍ¥Ä", color_base: "Î≤†Ïù¥Ïä§", color_title: "Ï†úÎ™©", color_time: "ÌòÑÏû¨ ÏãúÍ∞Ñ", color_route: "ÎÖ∏ÏÑ†Î™Ö", color_scheduled: "Ï†ïÏãú ÏãúÍ∞Ñ", color_predicted: "ÏòàÏ∏° ÏãúÍ∞Ñ",
            terms_text_1: "Î≤ÑÏä§ Ïö¥Ìñâ Ï†ïÎ≥¥ Í≤åÏãúÌåêÏùÄ ÌÜ†Î∂Ä Î≤ÑÏä§ Î∞è Ï£ºÏãùÌöåÏÇ¨ NAVITIME JAPANÏù¥ Ï†úÍ≥µÌïòÎäî 'Î≤ÑÏä§ ÏúÑÏπò'ÏóêÏÑú Ïä§ÌÅ¨Î†àÏù¥ÌïëÌïú Í≤ÉÏûÖÎãàÎã§. Îã®, Ïù¥Í≤ÉÏùÄ ÌîÑÎ°úÌÜ†ÌÉÄÏûÖÏù¥ÎØÄÎ°ú Ïã§Ï†ú Ïä§ÌÅ¨Î†àÏù¥ÌïëÏùÄ ÌïòÏßÄ ÏïäÏäµÎãàÎã§.",
            terms_text_2: "ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÌÜ†Î∂Ä Î≤ÑÏä§Ïùò '<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">Ïù¥Ïö© ÏïàÎÇ¥ (Î©¥Ï±Ö ÏÇ¨Ìï≠ Îì±)</a>'Î•º ÌôïÏù∏Ìï¥ Ï£ºÏã≠ÏãúÏò§."
        }
    };

    const DOMElements = {
        welcomeScreen: document.getElementById('welcome-screen'),
        mainContainer: document.getElementById('main-container'),
        busStatus: document.getElementById('bus-status'),
        settingsPanel: document.getElementById('settings-panel'),
        timeTable: document.getElementById('time-table'),
        titleText: document.getElementById('title-text'),
        routeName: document.getElementById('route-name'),
        currentTime: document.getElementById('current-time'),
        settingsPanels: document.querySelectorAll('.settings-area > div')
    };

    const times = [ { scheduled: "16:43", predicted: "16:46" }, { scheduled: "16:51", predicted: "16:55" }, { scheduled: "16:57", predicted: "16:59" }];
    times.forEach(entry => {
        const row = document.createElement("div");
        row.className = "time-row";
        row.innerHTML = `<div><span class="label-base label-scheduled"></span> <span class="time-large scheduled-time">${entry.scheduled}</span></div>` +
                      `<div><span class="label-base label-predicted"></span> <span class="time-large predicted-time">${entry.predicted}</span> <span class="label-base label-departure"></span></div>`;
        DOMElements.timeTable.appendChild(row);
    });

    function startApp(lang) {
        DOMElements.welcomeScreen.style.display = 'none';
        DOMElements.mainContainer.style.display = 'flex';
        const targetButton = document.querySelector(`#language-settings button[data-lang='${lang}']`);
        if (targetButton) selectLanguage(targetButton);
        else updateUI(lang);
    }

    function openSettings() {
        DOMElements.busStatus.classList.add('settings-active');
        DOMElements.settingsPanel.style.display = "flex";
        showSettingsPanel('settings-main');
        updateUI(document.documentElement.lang);
    }

    function closeSettings() {
        DOMElements.busStatus.classList.remove('settings-active');
        DOMElements.settingsPanel.style.display = "none";
        updateUI(document.documentElement.lang);
    }
    
    function showSettingsPanel(panelIdToShow) {
        DOMElements.settingsPanels.forEach(panel => panel.classList.add('hidden'));
        document.getElementById(panelIdToShow).classList.remove('hidden');
        if (panelIdToShow === 'display-settings') initializeColorPickers();
    }
    
    function rgbToHex(rgb) {
        if (rgb.startsWith('#')) return rgb;
        const [r, g, b] = rgb.match(/\d+/g).map(Number);
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }

    function initializeColorPickers() {
        const colorMap = { base: '.label-base', title: '#title-text', time: '#current-time', route: '#route-name', scheduled: '.scheduled-time', predicted: '.predicted-time' };
        for (const type in colorMap) {
            const picker = document.getElementById(`color-picker-${type}`);
            const element = document.querySelector(colorMap[type]);
            if (picker && element) picker.value = rgbToHex(window.getComputedStyle(element).color);
        }
    }
    
    function changeColor(type, color) {
        const selectorMap = { base: ".label-base", title: "#title-text", time: "#current-time", route: "#route-name", scheduled: ".scheduled-time", predicted: ".predicted-time" };
        document.querySelectorAll(selectorMap[type]).forEach(e => e.style.color = color);
    }

    function selectLanguage(selectedButton) {
        document.querySelectorAll(".language-buttons button").forEach(b => b.classList.remove("active"));
        selectedButton.classList.add("active");
        updateUI(selectedButton.dataset.lang);
    }
    
    function selectRoute(selectedButton, routeId) {
        document.querySelectorAll(".route-selection-buttons button").forEach(b => b.classList.remove("active"));
        selectedButton.classList.add("active");
        currentRouteId = routeId;
        updateUI(document.documentElement.lang);
    }
    
    function updateUI(lang) {
        const t = translations[lang];
        document.documentElement.lang = lang;

        const textContentMap = {
            'title-text': t.title, 'route-name': routeData[currentRouteId][lang], 'settings-back-to-main-text': t.settings_back_to_main, 'settings-main-title': t.settings_main_title,
            'settings-btn-display': t.btn_display, 'settings-btn-stop': t.btn_stop, 'settings-btn-lang': t.btn_lang, 'settings-btn-terms': t.btn_terms, 'display-settings-back-text': t.settings_back,
            'display-settings-title': t.display_title, 'color-label-base': t.color_base, 'color-label-title': t.color_title, 'color-label-time': t.color_time, 'color-label-route': t.color_route,
            'color-label-scheduled': t.color_scheduled, 'color-label-predicted': t.color_predicted, 'lang-settings-back-text': t.settings_back, 'lang-settings-title': t.lang_title,
            'bus-stop-settings-back-text': t.settings_back, 'bus-stop-settings-title': t.bus_stop_title, 'route-btn-mukaihara': routeData.mukaihara[lang], 'route-btn-reitaku': routeData.reitaku[lang],
            'terms-settings-title': t.terms_title, 'terms-settings-back-text': t.settings_back
        };
        for (const id in textContentMap) document.getElementById(id).innerText = textContentMap[id];
        
        document.querySelectorAll('.label-scheduled').forEach(el => el.innerText = t.scheduled);
        document.querySelectorAll('.label-predicted').forEach(el => el.innerText = t.predicted);
        document.querySelectorAll('.label-departure').forEach(el => el.innerText = t.departure);
        
        document.getElementById('terms-text-1').innerHTML = t.terms_text_1;
        document.getElementById('terms-text-2').innerHTML = t.terms_text_2;

        DOMElements.titleText.style.fontSize = '';
        DOMElements.routeName.style.fontSize = '';
        const isSettingsActive = DOMElements.busStatus.classList.contains('settings-active');

        if (currentRouteId === 'reitaku' && lang === 'en') {
            DOMElements.routeName.style.fontSize = isSettingsActive ? '3.0vw' : '3.8vw';
        } else if (currentRouteId === 'reitaku' && lang === 'ko' && isSettingsActive) {
            DOMElements.routeName.style.fontSize = '3.4vw';
        }
        if (isSettingsActive && lang === 'en') {
            DOMElements.titleText.style.fontSize = '3.5vw';
        }
    }
    
    // Initial Load
    DOMElements.currentTime.innerText = '16:40';
    updateUI('ja');
</script>
</body>
</html>
