<!DOCTYPE html>
<html lang="ja" id="html-tag">
<head>
  <meta charset="UTF-8">
  <title>ãƒã‚¹é‹è¡ŒçŠ¶æ³</title>
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans JP", sans-serif;
      overflow: hidden;
    }
    body:lang(ko) { font-family: "Noto Sans KR", sans-serif; }
    body:lang(zh-CN) { font-family: "Noto Sans SC", sans-serif; }
    body:lang(zh-TW) { font-family: "Noto Sans TC", sans-serif; }
    #welcome-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #222;
      color: white;
    }
    #welcome-screen h1 {
      font-size: 2.5em;
      display: flex;
      align-items: center;
      border-bottom: 2px solid white;
      padding-bottom: 20px;
      margin-bottom: 40px;
    }
    .welcome-lang-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    .welcome-lang-buttons button {
      font-size: 1.5em;
      padding: 20px;
      background-color: #444;
      color: white;
      border: 1px solid #666;
      cursor: pointer;
      border-radius: 8px;
    }
    .welcome-lang-buttons .full-width {
      grid-column: 1 / -1;
    }
    .main {
      display: flex;
      width: 100%;
      height: 100vh;
    }
    .bus-area {
      background-color: #222;
      color: white;
      padding: 2.5vw;
      flex: 1;
      display: flex;
      flex-direction: column;
      transition: transform 0.4s ease-in-out, filter 0.4s ease-in-out;
      transform-origin: center;
    }
    .bus-area.settings-active {
      transform: scale(0.85);
      border-radius: 20px;
      filter: brightness(0.7);
      box-shadow: -5px 0 25px rgba(0,0,0,0.5);
    }
    .settings-area {
      background-color: #ddd;
      color: black;
      padding: 20px;
      flex: 0 0 320px;
      display: none;
      flex-direction: column;
    }
    .settings-area > div {
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 1.5vh;
    }
    .left {
      display: flex;
      align-items: center;
      white-space: nowrap;
    }
    .bus-icon { font-size: 3.8vw; }
    .title { font-size: 4vw; margin-left: 2vw; }
    .gear { font-size: 3.5vw; cursor: pointer; }
    #current-time { font-size: 3.5vw; }
    .route {
      font-size: 5vw;
      margin: 2vh 0;
      border-top: 2px solid white;
      padding-top: 2vh;
      color: #FFA600;
    }
    .time-table {
      font-size: 4vw;
      line-height: 1.7;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
    }
    .time-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      white-space: nowrap;
      padding: 0 2.5vw;
      box-sizing: border-box;
    }
    .time-large {
      font-size: 6.5vw;
      font-weight: bold;
    }
    .bus-area.settings-active .route { font-size: 4vw; }
    .bus-area.settings-active .time-table { font-size: 3.5vw; }
    .bus-area.settings-active .time-large { font-size: 5.5vw; }
    .predicted-time { color: #FFD000; }
    .hidden { display: none !important; }
    .header-row {
      display: flex;
      align-items: center;
      font-size: 24px;
      cursor: pointer;
    }
    .header-row .back-arrow { font-size: 30px; font-weight: bold; }
    .header-row span { margin-left: 10px; }
    .section { margin-top: 30px; }
    .section.scrollable {
        flex: 1;
        overflow-y: auto;
        min-height: 0;
        padding-right: 10px;
        font-size: 16px;
        line-height: 1.6;
    }
    .section.scrollable a {
        color: #0000EE;
    }
    .setting-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    .setting-buttons button {
      font-size: 20px;
      padding: 15px 10px;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
      min-width: 0;
      border-radius: 5px;
    }
    .language-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 10px;
    }
    .language-buttons button {
      font-size: 18px;
      padding: 15px;
      background-color: #555;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
      border-radius: 5px;
    }
    .route-selection-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 10px;
    }
    .route-selection-buttons button {
        font-size: 18px;
        padding: 15px;
        background-color: #555;
        color: white;
        border: none;
        cursor: pointer;
        text-align: center;
        border-radius: 5px;
    }
    .language-buttons button.active,
    .route-selection-buttons button.active { background-color: #4CAF50; }
    .color-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 18px;
    }
    .color-row input[type="color"] {
      width: 50px;
      height: 30px;
      border: none;
      cursor: pointer;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

  <div id="welcome-screen">
      <h1><span class="bus-icon">ğŸš</span> é‹è¡Œæƒ…å ±è¡¨ç¤ºæ¿</h1>
      <div class="welcome-lang-buttons">
          <button onclick="startApp('ja')">æ—¥æœ¬èª</button>
          <button onclick="startApp('en')">English</button>
          <button onclick="startApp('zh-CN')">ä¸­æ–‡(ç®€ä½“)</button>
          <button onclick="startApp('zh-TW')">ä¸­æ–‡(ç°¡é«”)</button>
          <button class="full-width" onclick="startApp('ko')">í•œêµ­ì–´</button>
      </div>
  </div>

  <div class="main" id="main-container" style="display: none;">
    <div class="bus-area" id="bus-status">
      <div class="top-bar">
        <div class="left">
          <span class="bus-icon">ğŸš</span>
          <span class="title" id="title-text"></span>
        </div>
        <div>
          <span id="current-time" style="margin-right: 10px;">16:40</span>
          <span class="gear" onclick="openSettings()">âš™ï¸</span>
        </div>
      </div>
      <div class="route" id="route-name"></div>
      <div class="time-table" id="time-table"></div>
    </div>

    <div class="settings-area" id="settings-panel">
      <div id="settings-main">
        <div class="header-row" onclick="closeSettings()"><span class="back-arrow">&lt;</span> <span id="settings-back-to-main-text"></span></div>
        <div class="section">
          <h3 id="settings-main-title"></h3>
          <div class="setting-buttons">
            <button id="settings-btn-display" onclick="showSettingsPanel('display-settings')"></button>
            <button id="settings-btn-stop" onclick="showSettingsPanel('bus-stop-settings')"></button>
            <button id="settings-btn-lang" onclick="showSettingsPanel('language-settings')"></button>
            <button id="settings-btn-terms" onclick="showSettingsPanel('terms-settings')"></button>
          </div>
        </div>
      </div>

      <div id="display-settings" class="hidden">
        <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span> <span id="display-settings-back-text"></span></div>
        <div class="section">
          <h3 id="display-settings-title"></h3>
          <div class="color-row"><span id="color-label-base"></span><input type="color" id="color-picker-base" onchange="changeColor('base', this.value)"></div>
          <div class="color-row"><span id="color-label-title"></span><input type="color" id="color-picker-title" onchange="changeColor('title', this.value)"></div>
          <div class="color-row"><span id="color-label-time"></span><input type="color" id="color-picker-time" onchange="changeColor('time', this.value)"></div>
          <div class="color-row"><span id="color-label-route"></span><input type="color" id="color-picker-route" onchange="changeColor('route', this.value)"></div>
          <div class="color-row"><span id="color-label-scheduled"></span><input type="color" id="color-picker-scheduled" onchange="changeColor('scheduled', this.value)"></div>
          <div class="color-row"><span id="color-label-predicted"></span><input type="color" id="color-picker-predicted" onchange="changeColor('predicted', this.value)"></div>
        </div>
      </div>

      <div id="language-settings" class="hidden">
        <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span> <span id="lang-settings-back-text"></span></div>
        <div class="section">
          <h3 id="lang-settings-title"></h3>
          <div class="language-buttons">
            <button class="active" onclick="selectLanguage(this)" data-lang="ja">æ—¥æœ¬èª</button>
            <button onclick="selectLanguage(this)" data-lang="en">English</button>
            <button onclick="selectLanguage(this)" data-lang="zh-CN">ä¸­æ–‡(ç®€ä½“)</button>
            <button onclick="selectLanguage(this)" data-lang="zh-TW">ä¸­æ–‡(ç°¡é«”)</button>
            <button onclick="selectLanguage(this)" data-lang="ko">í•œêµ­ì–´</button>
          </div>
        </div>
      </div>
      
      <div id="bus-stop-settings" class="hidden">
        <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span> <span id="bus-stop-settings-back-text"></span></div>
        <div class="section">
          <h3 id="bus-stop-settings-title"></h3>
          <div class="route-selection-buttons">
            <button id="route-btn-mukaihara" class="active" onclick="selectRoute(this, 'mukaihara')"></button>
            <button id="route-btn-reitaku" onclick="selectRoute(this, 'reitaku')"></button>
          </div>
        </div>
      </div>

      <div id="terms-settings" class="hidden">
          <div class="header-row" onclick="showSettingsPanel('settings-main')"><span class="back-arrow">&lt;</span><span id="terms-settings-back-text"></span></div>
          <div class="section scrollable">
              <h3 id="terms-settings-title"></h3>
              <p id="terms-text-1"></p>
              <p id="terms-text-2"></p>
          </div>
      </div>

    </div>
  </div>

<script>
    let currentRouteId = 'mukaihara';
    const routeData = {
        mukaihara: { ja: "å‘åŸ â å—æŸé§…æ±å£", en: "Mukaihara â†’ Minami-Kashiwa Sta. EAST", 'zh-CN': "å‘åŸ â†’ å—æŸç«™ä¸œå£", 'zh-TW': "å‘åŸ â†’ å—æŸç«™æ±å£", ko: "ë¬´ì¹´ì´í•˜ë¼ â†’ ë¯¸ë‚˜ë¯¸ì¹´ì‹œì™€ì—­ ë™ìª½ ì¶œêµ¬" },
        reitaku: { ja: "éº—æ¾¤å¤§å­¦å‰ â å—æŸé§…æ±å£", en: "Reitaku Daigaku-mae â†’ Minami-Kashiwa Sta. EAST", 'zh-CN': "ä¸½æ³½å¤§å­¦å‰ â†’ å—æŸç«™ä¸œå£", 'zh-TW': "éº—æ¾¤å¤§å­¸å‰ â†’ å—æŸç«™æ±å£", ko: "ë ˆì´íƒ€ì¿ ëŒ€í•™ ì• â†’ ë¯¸ë‚˜ë¯¸ì¹´ì‹œì™€ì—­ ë™ìª½ ì¶œêµ¬" }
    };
    const translations = {
        ja: { title: "ãƒã‚¹é‹è¡ŒçŠ¶æ³", scheduled: "å®šåˆ»", predicted: "äºˆæ¸¬", departure: "ç™º", settings_back_to_main: "ãƒ¡ã‚¤ãƒ³ç”»é¢", settings_main_title: "è¨­å®š", btn_display: "è¡¨ç¤º", btn_stop: "ãƒã‚¹åœå¤‰æ›´", btn_lang: "è¨€èª", btn_terms: "åˆ©ç”¨è¦ç´„", settings_back: "è¨­å®š", display_title: "è¡¨ç¤º", lang_title: "è¨€èª", bus_stop_title: "ãƒã‚¹åœå¤‰æ›´", terms_title: "åˆ©ç”¨è¦ç´„", color_base: "ãƒ™ãƒ¼ã‚¹", color_title: "ã‚¿ã‚¤ãƒˆãƒ«", color_time: "ç¾åœ¨æ™‚åˆ»", color_route: "è·¯ç·šå", color_scheduled: "å®šåˆ»æ™‚é–“", color_predicted: "äºˆæ¸¬æ™‚é–“",
            terms_text_1: "é‹è¡Œæƒ…å ±è¡¨ç¤ºæ¿ã¯æ±æ­¦ãƒã‚¹åŠã³æ ªå¼ä¼šç¤¾ãƒŠãƒ“ã‚¿ã‚¤ãƒ ã‚¸ãƒ£ãƒ‘ãƒ³ãŒæä¾›ã™ã‚‹ã€Œãƒã‚¹æ¥è¿‘æƒ…å ±ã€ã‹ã‚‰ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ãŸã‚‚ã®ã§ã™ã€‚ãŸã ã—ã€ã“ã‚Œã¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã‚ã‚‹ãŸã‚ã€ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’è¡Œã£ã¦ãŠã‚Šã¾ã›ã‚“ã€‚",
            terms_text_2: "è©³ã—ãã¯æ±æ­¦ãƒã‚¹ã€Œ<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦ï¼ˆå…è²¬ã«ã¤ã„ã¦ç­‰ï¼‰</a>ã€ã‚’ã”è¦§ãã ã•ã„ã€‚"
        },
        en: { title: "Bus operation status", scheduled: "Schedule", predicted: "Predicted", departure: "", settings_back_to_main: "Main screen", settings_main_title: "Setting", btn_display: "Display", btn_stop: "Bus stop change", btn_lang: "Language", btn_terms: "Terms of service", settings_back: "Setting", display_title: "Display", lang_title: "Language", bus_stop_title: "Bus stop change", terms_title: "Terms of service", color_base: "Base", color_title: "Title", color_time: "Current time", color_route: "Route name", color_scheduled: "Scheduled time", color_predicted: "Predicted time",
            terms_text_1: "The Bus Operation Status board is scraped from the 'Bus Proximity Information' provided by Tobu Bus and NAVITIME JAPAN CORPORATION. However, as this is a prototype, it does not actually perform scraping.",
            terms_text_2: "For details, please see the Tobu Bus '<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">Terms of Use (Disclaimer, etc.)</a>'."
        },
        'zh-CN': { title: "å…¬äº¤è¿è¥çŠ¶å†µ", scheduled: "é¢„å®š", predicted: "é¢„è®¡", departure: "å‡ºå‘", settings_back_to_main: "ä¸»å±å¹•", settings_main_title: "è®¾ç½®", btn_display: "æ˜¾ç¤º", btn_stop: "å…¬äº¤è½¦ç«™å˜æ›´", btn_lang: "è¯­è¨€", btn_terms: "æœåŠ¡æ¡æ¬¾", settings_back: "è®¾ç½®", display_title: "æ˜¾ç¤º", lang_title: "è¯­è¨€", bus_stop_title: "å…¬äº¤è½¦ç«™å˜æ›´", terms_title: "æœåŠ¡æ¡æ¬¾", color_base: "åŸºç¡€", color_title: "æ ‡é¢˜", color_time: "å½“å‰æ—¶é—´", color_route: "è·¯çº¿åç§°", color_scheduled: "é¢„å®šæ—¶é—´", color_predicted: "é¢„è®¡æ—¶é—´",
            terms_text_1: "æ­¤å…¬äº¤è½¦è¿è¡Œä¿¡æ¯æ˜¾ç¤ºæ¿çš„å†…å®¹æ˜¯ä»ä¸œæ­¦å·´å£«ä»¥åŠNAVITIME JAPANå…¬å¸æä¾›çš„â€œå…¬äº¤è½¦æ¥è¿‘ä¿¡æ¯â€ä¸­æŠ“å–çš„ã€‚ä½†ç”±äºè¿™åªæ˜¯ä¸€ä¸ªåŸå‹ï¼Œå› æ­¤å¹¶æœªå®é™…è¿›è¡ŒæŠ“å–ã€‚",
            terms_text_2: "è¯¦æƒ…è¯·å‚é˜…ä¸œæ­¦å·´å£«çš„â€œ<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">ä½¿ç”¨æ¡æ¬¾ï¼ˆå…è´£å£°æ˜ç­‰ï¼‰</a>â€ã€‚"
        },
        'zh-TW': { title: "å…¬è»Šç‡Ÿé‹ç‹€æ³", scheduled: "é å®š", predicted: "é æ¸¬", departure: "å‡ºç™¼", settings_back_to_main: "ä¸»è¢å¹•", settings_main_title: "è¨­å®š", btn_display: "é¡¯ç¤º", btn_stop: "å…¬è»Šç«™è®Šæ›´", btn_lang: "èªè¨€", btn_terms: "æœå‹™æ¢æ¬¾", settings_back: "è¨­å®š", display_title: "é¡¯ç¤º", lang_title: "èªè¨€", bus_stop_title: "å…¬è»Šç«™è®Šæ›´", terms_title: "æœå‹™æ¢æ¬¾", color_base: "åŸºç¤", color_title: "æ¨™é¡Œ", color_time: "ç•¶å‰æ™‚é–“", color_route: "è·¯ç·šåç¨±", color_scheduled: "é å®šæ™‚é–“", color_predicted: "é æ¸¬æ™‚é–“",
            terms_text_1: "æ­¤å…¬è»Šç‡Ÿé‹ç‹€æ³é¡¯ç¤ºæ¿çš„å…§å®¹æ˜¯å¾æ±æ­¦å·´å£«ä»¥åŠNAVITIME JAPANå…¬å¸æä¾›çš„ã€Œå…¬è»Šæ¥è¿‘è³‡è¨Šã€ä¸­æ“·å–çš„ã€‚ä½†ç”±æ–¼é€™åªæ˜¯ä¸€å€‹åŸå‹ï¼Œå› æ­¤ä¸¦æœªå¯¦éš›é€²è¡Œæ“·å–ã€‚",
            terms_text_2: "è©³æƒ…è«‹åƒé–±æ±æ­¦å·´å£«çš„ã€Œ<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">ä½¿ç”¨æ¢æ¬¾ï¼ˆå…è²¬è²æ˜ç­‰ï¼‰</a>ã€ã€‚"
        },
        ko: { title: "ë²„ìŠ¤ ìš´í–‰ í˜„í™©", scheduled: "ì •ì‹œ", predicted: "ì˜ˆì¸¡", departure: "ì¶œë°œ", settings_back_to_main: "ë©”ì¸ í™”ë©´", settings_main_title: "ì„¤ì •", btn_display: "í‘œì‹œ", btn_stop: "ë²„ìŠ¤ ì •ë¥˜ì¥ ë³€ê²½", btn_lang: "ì–¸ì–´", btn_terms: "ì´ìš©ì•½ê´€", settings_back: "ì„¤ì •", display_title: "í‘œì‹œ", lang_title: "ì–¸ì–´", bus_stop_title: "ë²„ìŠ¤ ì •ë¥˜ì¥ ë³€ê²½", terms_title: "ì´ìš©ì•½ê´€", color_base: "ë² ì´ìŠ¤", color_title: "ì œëª©", color_time: "í˜„ì¬ ì‹œê°„", color_route: "ë…¸ì„ ëª…", color_scheduled: "ì •ì‹œ ì‹œê°„", color_predicted: "ì˜ˆì¸¡ ì‹œê°„",
            terms_text_1: "ë²„ìŠ¤ ìš´í–‰ ì •ë³´ ê²Œì‹œíŒì€ í† ë¶€ ë²„ìŠ¤ ë° ì£¼ì‹íšŒì‚¬ NAVITIME JAPANì´ ì œê³µí•˜ëŠ” 'ë²„ìŠ¤ ì ‘ê·¼ ì •ë³´'ì—ì„œ ìŠ¤í¬ë ˆì´í•‘í•œ ê²ƒì…ë‹ˆë‹¤. ë‹¨, ì´ê²ƒì€ í”„ë¡œí† íƒ€ì…ì´ë¯€ë¡œ ì‹¤ì œ ìŠ¤í¬ë ˆì´í•‘ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            terms_text_2: "ìì„¸í•œ ë‚´ìš©ì€ í† ë¶€ ë²„ìŠ¤ì˜ '<a href=\"https://transfer-cloud.navitime.biz/tobubus/terms-of-use\" target=\"_blank\" rel=\"noopener noreferrer\">ì´ìš© ì•ˆë‚´ (ë©´ì±… ì‚¬í•­ ë“±)</a>'ë¥¼ í™•ì¸í•´ ì£¼ì‹­ì‹œì˜¤."
        }
    };

    const DOMElements = {
        welcomeScreen: document.getElementById('welcome-screen'),
        mainContainer: document.getElementById('main-container'),
        busStatus: document.getElementById('bus-status'),
        settingsPanel: document.getElementById('settings-panel'),
        timeTable: document.getElementById('time-table'),
        titleText: document.getElementById('title-text'),
        routeName: document.getElementById('route-name'),
        currentTime: document.getElementById('current-time'),
        settingsPanels: document.querySelectorAll('.settings-area > div')
    };

    const times = [ { scheduled: "16:43", predicted: "16:46" }, { scheduled: "16:51", predicted: "16:55" }, { scheduled: "16:57", predicted: "16:59" }];
    times.forEach(entry => {
        const row = document.createElement("div");
        row.className = "time-row";
        row.innerHTML = `<div><span class="label-base label-scheduled"></span> <span class="time-large scheduled-time">${entry.scheduled}</span></div>` +
                      `<div><span class="label-base label-predicted"></span> <span class="time-large predicted-time">${entry.predicted}</span> <span class="label-base label-departure"></span></div>`;
        DOMElements.timeTable.appendChild(row);
    });

    function startApp(lang) {
        DOMElements.welcomeScreen.style.display = 'none';
        DOMElements.mainContainer.style.display = 'flex';
        const targetButton = document.querySelector(`#language-settings button[data-lang='${lang}']`);
        if (targetButton) selectLanguage(targetButton);
        else updateUI(lang);
    }

    function openSettings() {
        DOMElements.busStatus.classList.add('settings-active');
        DOMElements.settingsPanel.style.display = "flex";
        showSettingsPanel('settings-main');
        updateUI(document.documentElement.lang);
    }

    function closeSettings() {
        DOMElements.busStatus.classList.remove('settings-active');
        DOMElements.settingsPanel.style.display = "none";
        updateUI(document.documentElement.lang);
    }
    
    function showSettingsPanel(panelIdToShow) {
        DOMElements.settingsPanels.forEach(panel => panel.classList.add('hidden'));
        document.getElementById(panelIdToShow).classList.remove('hidden');
        if (panelIdToShow === 'display-settings') initializeColorPickers();
    }
    
    function rgbToHex(rgb) {
        if (rgb.startsWith('#')) return rgb;
        const [r, g, b] = rgb.match(/\d+/g).map(Number);
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }

    function initializeColorPickers() {
        const colorMap = { base: '.label-base', title: '#title-text', time: '#current-time', route: '#route-name', scheduled: '.scheduled-time', predicted: '.predicted-time' };
        for (const type in colorMap) {
            const picker = document.getElementById(`color-picker-${type}`);
            const element = document.querySelector(colorMap[type]);
            if (picker && element) picker.value = rgbToHex(window.getComputedStyle(element).color);
        }
    }
    
    function changeColor(type, color) {
        const selectorMap = { base: ".label-base", title: "#title-text", time: "#current-time", route: "#route-name", scheduled: ".scheduled-time", predicted: ".predicted-time" };
        document.querySelectorAll(selectorMap[type]).forEach(e => e.style.color = color);
    }

    function selectLanguage(selectedButton) {
        document.querySelectorAll(".language-buttons button").forEach(b => b.classList.remove("active"));
        selectedButton.classList.add("active");
        updateUI(selectedButton.dataset.lang);
    }
    
    function selectRoute(selectedButton, routeId) {
        document.querySelectorAll(".route-selection-buttons button").forEach(b => b.classList.remove("active"));
        selectedButton.classList.add("active");
        currentRouteId = routeId;
        updateUI(document.documentElement.lang);
    }
    
    function updateUI(lang) {
        const t = translations[lang];
        document.documentElement.lang = lang;

        const textContentMap = {
            'title-text': t.title, 'route-name': routeData[currentRouteId][lang], 'settings-back-to-main-text': t.settings_back_to_main, 'settings-main-title': t.settings_main_title,
            'settings-btn-display': t.btn_display, 'settings-btn-stop': t.btn_stop, 'settings-btn-lang': t.btn_lang, 'settings-btn-terms': t.btn_terms, 'display-settings-back-text': t.settings_back,
            'display-settings-title': t.display_title, 'color-label-base': t.color_base, 'color-label-title': t.color_title, 'color-label-time': t.color_time, 'color-label-route': t.color_route,
            'color-label-scheduled': t.color_scheduled, 'color-label-predicted': t.color_predicted, 'lang-settings-back-text': t.settings_back, 'lang-settings-title': t.lang_title,
            'bus-stop-settings-back-text': t.settings_back, 'bus-stop-settings-title': t.bus_stop_title, 'route-btn-mukaihara': routeData.mukaihara[lang], 'route-btn-reitaku': routeData.reitaku[lang],
            'terms-settings-title': t.terms_title, 'terms-settings-back-text': t.settings_back
        };
        for (const id in textContentMap) document.getElementById(id).innerText = textContentMap[id];
        
        document.querySelectorAll('.label-scheduled').forEach(el => el.innerText = t.scheduled);
        document.querySelectorAll('.label-predicted').forEach(el => el.innerText = t.predicted);
        document.querySelectorAll('.label-departure').forEach(el => el.innerText = t.departure);
        
        document.getElementById('terms-text-1').innerHTML = t.terms_text_1;
        document.getElementById('terms-text-2').innerHTML = t.terms_text_2;

        DOMElements.titleText.style.fontSize = '';
        DOMElements.routeName.style.fontSize = '';
        const isSettingsActive = DOMElements.busStatus.classList.contains('settings-active');

        if (currentRouteId === 'reitaku' && lang === 'en') {
            DOMElements.routeName.style.fontSize = isSettingsActive ? '3.0vw' : '3.8vw';
        } else if (currentRouteId === 'reitaku' && lang === 'ko' && isSettingsActive) {
            DOMElements.routeName.style.fontSize = '3.4vw';
        }
        if (isSettingsActive && lang === 'en') {
            DOMElements.titleText.style.fontSize = '3.5vw';
        }
    }
    
    // Initial Load
    DOMElements.currentTime.innerText = '16:40';
    updateUI('ja');
</script>
</body>
</html>
