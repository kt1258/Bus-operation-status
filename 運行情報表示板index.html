<!DOCTYPE html>
<html lang="ja" id="html-tag">
<head>
  <meta charset="UTF-8">
  <title>ãƒã‚¹é‹è¡ŒçŠ¶æ³</title>
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans JP", sans-serif;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
    }
    
    html[lang="ko"] body { font-family: "Noto Sans KR", sans-serif; }
    html[lang="zh-CN"] body { font-family: "Noto Sans SC", sans-serif; }
    html[lang="zh-TW"] body { font-family: "Noto Sans TC", sans-serif; }

    #welcome-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #222;
      color: white;
    }
    #welcome-screen h1 {
      font-size: 2.5em;
      display: flex;
      align-items: center;
      border-bottom: 2px solid white;
      padding-bottom: 20px;
      margin-bottom: 40px;
    }
    .welcome-lang-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    .welcome-lang-buttons button {
      font-size: 1.5em;
      padding: 20px;
      background-color: #444;
      color: white;
      border: 1px solid #666;
      cursor: pointer;
      border-radius: 8px;
    }
    .welcome-lang-buttons .full-width {
      grid-column: 1 / -1;
    }

    .main {
      display: flex;
      width: 100%;
      height: 100vh;
    }

    .bus-area {
      background-color: #222;
      color: white;
      padding: 2.5vw;
      flex: 1;
      display: flex;
      flex-direction: column;
      transition: transform 0.4s ease-in-out, filter 0.4s ease-in-out;
      transform-origin: center;
    }
    .bus-area.settings-active {
      transform: scale(0.85);
      border-radius: 20px;
      filter: brightness(0.7);
      box-shadow: -5px 0 25px rgba(0,0,0,0.5);
    }

    .settings-area {
      background-color: #ddd;
      color: black;
      padding: 20px;
      flex: 0 0 320px;
      display: none;
      flex-direction: column;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 1.5vh;
    }
    .left {
      display: flex;
      align-items: center;
      white-space: nowrap;
    }
    .bus-icon { font-size: 3.8vw; }
    .title { font-size: 4vw; margin-left: 2vw; }
    .gear { font-size: 3.5vw; cursor: pointer; }
    #current-time { font-size: 3.5vw; }
    .route { font-size: 4vw; margin: 2vh 0; border-top: 2px solid white; padding-top: 2vh; }
    .time-table { font-size: 3.5vw; line-height: 1.7; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-around; }
    .time-row { display: flex; justify-content: space-between; max-width: 100%; align-items: baseline; white-space: nowrap; }
    .time-large { font-size: 5.5vw; font-weight: bold; }

    .hidden { display: none; }
    .header-row { display: flex; align-items: center; font-size: 24px; cursor: pointer; }
    .header-row .back-arrow { font-size: 30px; font-weight: bold; }
    .header-row span { margin-left: 10px; }
    .section { margin-top: 30px; }

    .setting-buttons, .language-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    .setting-buttons button, .language-buttons button {
      font-size: 18px;
      padding: 15px;
      background-color: #555;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
      border-radius: 5px;
    }
    .setting-buttons button {
      font-size: 20px;
      padding: 15px 10px;
      background-color: #444;
    }
    .language-buttons button.active {
      background-color: #4CAF50;
    }

    .color-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 18px; }
    .color-row input[type="color"] { width: 50px; height: 30px; border: none; cursor: pointer; }
    .route-selection-buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 10px; }
    .route-selection-buttons button { font-size: 18px; padding: 15px; background-color: #555; color: white; border: none; cursor: pointer; text-align: center; border-radius: 5px; }
    .route-selection-buttons button.active { background-color: #4CAF50; }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

  <div id="welcome-screen">
      <h1><span class="bus-icon">ğŸš</span> é‹è¡Œæƒ…å ±è¡¨ç¤ºæ¿</h1>
      <div class="welcome-lang-buttons">
          <button onclick="startApp('ja')">æ—¥æœ¬èª</button>
          <button onclick="startApp('en')">English</button>
          <button onclick="startApp('zh-CN')">ä¸­æ–‡(ç®€ä½“)</button>
          <button onclick="startApp('zh-TW')">ä¸­æ–‡(ç°¡é«”)</button>
          <button class="full-width" onclick="startApp('ko')">í•œêµ­ì–´</button>
      </div>
  </div>

  <div class="main" id="main-container" style="display: none;">
    <div class="bus-area" id="bus-status">
      <div class="top-bar">
        <div class="left">
          <span class="bus-icon">ğŸš</span>
          <span class="title" data-translate="title">ãƒã‚¹é‹è¡ŒçŠ¶æ³</span>
        </div>
        <div>
          <span id="current-time" style="margin-right: 10px;">16:40</span>
          <span class="gear" onclick="openSettings()">âš™ï¸</span>
        </div>
      </div>
      <div class="route" id="route-name">å‘åŸ â å—æŸé§…æ±å£</div>
      <div class="time-table" id="time-table"></div>
    </div>

    <div class="settings-area" id="settings-panel">
      <div id="settings-main" class="settings-subpanel">
        <div class="header-row" onclick="closeSettings()">
           <span class="back-arrow">&lt;</span> <span data-translate="settings_back_to_main">ãƒ¡ã‚¤ãƒ³ç”»é¢</span>
        </div>
        <div class="section">
          <h3 data-translate="settings_main_title">è¨­å®š</h3>
          <div class="setting-buttons">
            <button data-translate="btn_display" onclick="showPanel('display-settings')">è¡¨ç¤º</button>
            <button data-translate="btn_stop" onclick="showPanel('bus-stop-settings')">ãƒã‚¹åœå¤‰æ›´</button>
            <button data-translate="btn_lang" onclick="showPanel('language-settings')">è¨€èª</button>
            <button data-translate="btn_terms" onclick="alert('åˆ©ç”¨è¦ç´„ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ')">åˆ©ç”¨è¦ç´„</button>
          </div>
        </div>
      </div>

      <div id="display-settings" class="settings-subpanel hidden">
        <div class="header-row" onclick="showPanel('settings-main')">
          <span class="back-arrow">&lt;</span> <span data-translate="settings_back">è¨­å®š</span>
        </div>
        <div class="section">
          <h3 data-translate="display_title">è¡¨ç¤º</h3>
          <div class="color-row"><span data-translate="color_base">ãƒ™ãƒ¼ã‚¹</span><input type="color" onchange="changeColor('base', this.value)"></div>
          <div class="color-row"><span data-translate="color_title">ã‚¿ã‚¤ãƒˆãƒ«</span><input type="color" onchange="changeColor('title', this.value)"></div>
          <div class="color-row"><span data-translate="color_time">ç¾åœ¨æ™‚åˆ»</span><input type="color" onchange="changeColor('time', this.value)"></div>
          <div class="color-row"><span data-translate="color_route">è·¯ç·šå</span><input type="color" onchange="changeColor('route', this.value)"></div>
          <div class="color-row"><span data-translate="color_scheduled">å®šåˆ»æ™‚é–“</span><input type="color" onchange="changeColor('scheduled', this.value)"></div>
          <div class="color-row"><span data-translate="color_predicted">äºˆæ¸¬æ™‚é–“</span><input type="color" onchange="changeColor('predicted', this.value)"></div>
        </div>
      </div>

      <div id="language-settings" class="settings-subpanel hidden">
        <div class="header-row" onclick="showPanel('settings-main')">
          <span class="back-arrow">&lt;</span> <span data-translate="settings_back">è¨­å®š</span>
        </div>
        <div class="section">
          <h3 data-translate="lang_title">è¨€èª</h3>
          <div class="language-buttons">
            <button class="active" onclick="selectLanguage(this)" data-lang="ja">æ—¥æœ¬èª</button>
            <button onclick="selectLanguage(this)" data-lang="en">English</button>
            <button onclick="selectLanguage(this)" data-lang="zh-CN">ä¸­æ–‡(ç®€ä½“)</button>
            <button onclick="selectLanguage(this)" data-lang="zh-TW">ä¸­æ–‡(ç°¡é«”)</button>
            <button onclick="selectLanguage(this)" data-lang="ko">í•œêµ­ì–´</button>
          </div>
        </div>
      </div>
      
      <div id="bus-stop-settings" class="settings-subpanel hidden">
        <div class="header-row" onclick="showPanel('settings-main')">
          <span class="back-arrow">&lt;</span> <span data-translate="settings_back">è¨­å®š</span>
        </div>
        <div class="section">
          <h3 data-translate="bus_stop_title">ãƒã‚¹åœå¤‰æ›´</h3>
          <div class="route-selection-buttons">
            <button id="route-btn-mukaihara" class="active" onclick="selectRoute(this, 'mukaihara')"></button>
            <button id="route-btn-reitaku" onclick="selectRoute(this, 'reitaku')"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentRouteId = 'mukaihara';
    const routeData = {
        mukaihara: { ja: "å‘åŸ â å—æŸé§…æ±å£", en: "Mukaihara â†’ Minami-Kashiwa Sta. EAST", 'zh-CN': "å‘åŸ â†’ å—æŸç«™ä¸œå£", 'zh-TW': "å‘åŸ â†’ å—æŸç«™æ±å£", ko: "ë¬´ì¹´ì´í•˜ë¼ â†’ ë¯¸ë‚˜ë¯¸ì¹´ì‹œì™€ì—­ ë™ìª½ ì¶œêµ¬" },
        reitaku: { ja: "éº—æ¾¤å¤§å­¦å‰ â å—æŸé§…æ±å£", en: "Reitaku Daigaku-mae â†’ Minami-Kashiwa Sta. EAST", 'zh-CN': "ä¸½æ³½å¤§å­¦å‰ â†’ å—æŸç«™ä¸œå£", 'zh-TW': "éº—æ¾¤å¤§å­¸å‰ â†’ å—æŸç«™æ±å£", ko: "ë ˆì´íƒ€ì¿ ëŒ€í•™ ì• â†’ ë¯¸ë‚˜ë¯¸ì¹´ì‹œì™€ì—­ ë™ìª½ ì¶œêµ¬" }
    };
    const translations = {
        ja: { title: "ãƒã‚¹é‹è¡ŒçŠ¶æ³", scheduled: "å®šåˆ»", predicted: "äºˆæ¸¬", departure: "ç™º", settings_back_to_main: "ãƒ¡ã‚¤ãƒ³ç”»é¢", settings_main_title: "è¨­å®š", btn_display: "è¡¨ç¤º", btn_stop: "ãƒã‚¹åœå¤‰æ›´", btn_lang: "è¨€èª", btn_terms: "åˆ©ç”¨è¦ç´„", settings_back: "è¨­å®š", display_title: "è¡¨ç¤º", lang_title: "è¨€èª", bus_stop_title: "ãƒã‚¹åœå¤‰æ›´", color_base: "ãƒ™ãƒ¼ã‚¹", color_title: "ã‚¿ã‚¤ãƒˆãƒ«", color_time: "ç¾åœ¨æ™‚åˆ»", color_route: "è·¯ç·šå", color_scheduled: "å®šåˆ»æ™‚é–“", color_predicted: "äºˆæ¸¬æ™‚é–“" },
        en: { title: "Bus operation status", scheduled: "Schedule", predicted: "Predicted", departure: "", settings_back_to_main: "Main screen", settings_main_title: "Setting", btn_display: "Display", btn_stop: "Bus stop change", btn_lang: "Language", btn_terms: "Terms of service", settings_back: "Setting", display_title: "Display", lang_title: "Language", bus_stop_title: "Bus stop change", color_base: "Base", color_title: "Title", color_time: "Current time", color_route: "Route name", color_scheduled: "Scheduled time", color_predicted: "Predicted time" },
        'zh-CN': { title: "å…¬äº¤è¿è¥çŠ¶å†µ", scheduled: "é¢„å®š", predicted: "é¢„è®¡", departure: "å‡ºå‘", settings_back_to_main: "ä¸»å±å¹•", settings_main_title: "è®¾ç½®", btn_display: "æ˜¾ç¤º", btn_stop: "å…¬äº¤è½¦ç«™å˜æ›´", btn_lang: "è¯­è¨€", btn_terms: "æœåŠ¡æ¡æ¬¾", settings_back: "è®¾ç½®", display_title: "æ˜¾ç¤º", lang_title: "è¯­è¨€", bus_stop_title: "å…¬äº¤è½¦ç«™å˜æ›´", color_base: "åŸºç¡€", color_title: "æ ‡é¢˜", color_time: "å½“å‰æ—¶é—´", color_route: "è·¯çº¿åç§°", color_scheduled: "é¢„å®šæ—¶é—´", color_predicted: "é¢„è®¡æ—¶é—´" },
        'zh-TW': { title: "å…¬è»Šç‡Ÿé‹ç‹€æ³", scheduled: "é å®š", predicted: "é æ¸¬", departure: "å‡ºç™¼", settings_back_to_main: "ä¸»è¢å¹•", settings_main_title: "è¨­å®š", btn_display: "é¡¯ç¤º", btn_stop: "å…¬è»Šç«™è®Šæ›´", btn_lang: "èªè¨€", btn_terms: "æœå‹™æ¢æ¬¾", settings_back: "è¨­å®š", display_title: "é¡¯ç¤º", lang_title: "èªè¨€", bus_stop_title: "å…¬è»Šç«™è®Šæ›´", color_base: "åŸºç¤", color_title: "æ¨™é¡Œ", color_time: "ç•¶å‰æ™‚é–“", color_route: "è·¯ç·šåç¨±", color_scheduled: "é å®šæ™‚é–“", color_predicted: "é æ¸¬æ™‚é–“" },
        ko: { title: "ë²„ìŠ¤ ìš´í–‰ í˜„í™©", scheduled: "ì •ì‹œ", predicted: "ì˜ˆì¸¡", departure: "ì¶œë°œ", settings_back_to_main: "ë©”ì¸ í™”ë©´", settings_main_title: "ì„¤ì •", btn_display: "í‘œì‹œ", btn_stop: "ë²„ìŠ¤ ì •ë¥˜ì¥ ë³€ê²½", btn_lang: "ì–¸ì–´", btn_terms: "ì´ìš©ì•½ê´€", settings_back: "ì„¤ì •", display_title: "í‘œì‹œ", lang_title: "ì–¸ì–´", bus_stop_title: "ë²„ìŠ¤ ì •ë¥˜ì¥ ë³€ê²½", color_base: "ë² ì´ìŠ¤", color_title: "ì œëª©", color_time: "í˜„ì¬ ì‹œê°„", color_route: "ë…¸ì„ ëª…", color_scheduled: "ì •ì‹œ ì‹œê°„", color_predicted: "ì˜ˆì¸¡ ì‹œê°„" }
    };
    const times = [ { scheduled: "16:43", predicted: "16:46" }, { scheduled: "16:51", predicted: "16:55" }, { scheduled: "16:57", predicted: "16:59" } ];

    const UIElements = {
        busStatus: document.getElementById('bus-status'),
        settingsPanel: document.getElementById('settings-panel'),
        settingsSubpanels: document.querySelectorAll('.settings-subpanel'),
        routeName: document.getElementById('route-name'),
        titleText: document.querySelector('[data-translate="title"]'),
        timeTable: document.getElementById('time-table')
    };

    function createTimeTable(lang) {
        const t = translations[lang];
        UIElements.timeTable.innerHTML = times.map(entry => `
            <div class="time-row">
                <div><span class="label-base">${t.scheduled}</span> <span class="time-large">${entry.scheduled}</span></div>
                <div><span class="label-base">${t.predicted}</span> <span class="time-large">${entry.predicted}</span> <span class="label-base">${t.departure}</span></div>
            </div>
        `).join('');
    }

    function startApp(lang) {
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('main-container').style.display = 'flex';
        selectLanguage(document.querySelector(`.language-buttons button[data-lang='${lang}']`));
    }

    function openSettings() {
      UIElements.busStatus.classList.add('settings-active');
      UIElements.settingsPanel.style.display = "flex";
      showPanel('settings-main');
      updateText(document.documentElement.lang || 'ja');
    }

    function closeSettings() {
      UIElements.busStatus.classList.remove('settings-active');
      UIElements.settingsPanel.style.display = "none";
      updateText(document.documentElement.lang || 'ja');
    }

    function showPanel(panelId) {
        UIElements.settingsSubpanels.forEach(panel => {
            panel.classList.toggle('hidden', panel.id !== panelId);
        });
    }

    function changeColor(type, color) {
        const root = document.documentElement;
        switch (type) {
            case "base": root.style.setProperty('--label-color', color); break;
            case "title": UIElements.titleText.style.color = color; break;
            case "time": document.getElementById('current-time').style.color = color; break;
            case "route": UIElements.routeName.style.color = color; break;
            case "scheduled": root.style.setProperty('--scheduled-time-color', color); break;
            case "predicted": root.style.setProperty('--predicted-time-color', color); break;
        }
    }
    
    function selectLanguage(selectedButton) {
        document.querySelectorAll(".language-buttons button").forEach(button => button.classList.remove("active"));
        selectedButton.classList.add("active");
        updateText(selectedButton.dataset.lang);
    }
    
    function selectRoute(selectedButton, routeId) {
        document.querySelectorAll(".route-selection-buttons button").forEach(button => button.classList.remove("active"));
        selectedButton.classList.add("active");
        currentRouteId = routeId;
        updateText(document.documentElement.lang || 'ja');
    }

    function updateText(lang) {
        document.documentElement.lang = lang;
        const t = translations[lang];
        
        document.querySelectorAll('[data-translate]').forEach(el => {
            el.innerText = t[el.dataset.translate];
        });

        UIElements.routeName.innerText = routeData[currentRouteId][lang];
        document.getElementById('route-btn-mukaihara').innerText = routeData.mukaihara[lang];
        document.getElementById('route-btn-reitaku').innerText = routeData.reitaku[lang];
        
        createTimeTable(lang);

        const isSettingsActive = UIElements.busStatus.classList.contains('settings-active');
        UIElements.titleText.style.fontSize = (isSettingsActive && lang === 'en') ? '3.5vw' : '';
        UIElements.routeName.style.fontSize = (isSettingsActive && currentRouteId === 'reitaku' && lang === 'en') ? '3.0vw' :
                                             (isSettingsActive && currentRouteId === 'reitaku' && lang === 'ko') ? '3.4vw' : '';
    }

    createTimeTable('ja');
  </script>
</body>
</html>